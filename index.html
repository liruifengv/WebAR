<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>调用摄像头拍照 </title>
    <style>
        #videoBox{
            position: absolute;
            left: 50%;
            top: 50%;
            z-index: 1;
            -webkit-transform: translate(-50%,-50%);
            -webkit-transform-origin: 50% 50%;
            background: #ff0000
        };
        #videoWrap{position: relative;left: 0;top: 0;background: #4CAABE;overflow: hidden;}
    </style>
</head>
<body>
    <div id="videoWrap">
        <video autoplay="autoplay" id="videoBox"></video>
    </div>
    <script src="/three.min.js"></script>
<script>
    try {　　
        // 此处是可能产生例外的语句
            var videoWrap = document.getElementById('videoWrap');
    let video = document.getElementById('videoBox')

    videoWrap.style.width = window.innerWidth + 'px';
    videoWrap.style.height = window.innerHeight + 'px';
   video.style.width = window.innerWidth + 'px';
    video.style.height = window.innerHeight + 'px';
    var vwidth = window.innerWidth;
    var vheight = window.innerHeight;
  function getUserMedia(constrains,success,error) {
    if (navigator.mediaDevices.getUserMedia) {
      navigator.mediaDevices.getUserMedia(constrains).then(success).catch(error)
    } else if (navigator.webkitGetUserMedia) {
      navigator.webkitGetUserMedia(constrains,success.error)
    } else if (navigator.mozGetUserMedia) {
      navigator.mozkitGetUserMedia(constrains,success.error)
    } else if (navigator.getUserMedia) {
      navigator.getUserMedia(constrains,success,error)
    }
  }
  function success(stream) {
    if(!stream) {
        alert('stream:',stream)
    }
    let CompatibleUrl = window.URL || window.webkitURL
    video.src = CompatibleUrl.createObjectURL(stream)
    video.play()
    init3D();
  }
  function error(error) {
    alert('ERROR:',error.name,error.message)
  }
  
  if (navigator.mediaDevices.getUserMedia || navigator.getUserMedia || navigator.mozGetUserMedia || navigator.webkitGetUserMedia) {
      try {　　
          // 此处是可能产生例外的语句
        getUserMedia({video:{ facingMode: { exact: "environment" }}},success,error)
        } catch (error) {　　
          // 此处是负责例外处理的语句
          alert(error);　　
        } finally {　　
          // 此处是出口语句
          console.log("执行完毕");
        }
  } else {
    alert('you bower id not getUserMedia')
  }
      } catch (error) {　　
        // 此处是负责例外处理的语句
        alert(error);　　
      } finally {　　
        // 此处是出口语句
      }
      		var camera, scene, renderer;
			var mesh;
    function init3D() {
			init();
			animate();
      }

			function init() {
				camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 1, 1000 );
				camera.position.z = 400;
				scene = new THREE.Scene();
				var texture = new THREE.TextureLoader().load( 'crate.gif' );
				var geometry = new THREE.BoxBufferGeometry( 200, 200, 200 );
				var material = new THREE.MeshBasicMaterial( { map: texture } );
				mesh = new THREE.Mesh( geometry, material );
				scene.add( mesh );
				renderer = new THREE.WebGLRenderer( { antialias: true } );
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				document.body.appendChild( renderer.domElement );
				//
				window.addEventListener( 'resize', onWindowResize, false );
			}
			function onWindowResize() {
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
				renderer.setSize( window.innerWidth, window.innerHeight );
			}
			function animate() {
				requestAnimationFrame( animate );
				mesh.rotation.x += 0.005;
				mesh.rotation.y += 0.01;
				renderer.render( scene, camera );
			}


</script>
</body>
</html>